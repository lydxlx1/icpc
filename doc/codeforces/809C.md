# Find a car

From Codeforces [809C](http://codeforces.com/problemset/problem/809/C)

**General description of the problem:**

By investigating the problem, we have the following pattern of generating recursively an $n \times n$ matrix where $n$ is a power of 2.
$$
\begin{bmatrix}
1
\end{bmatrix}
\rightarrow
\begin{bmatrix}
1 & 2 \\
2 & 1\\
\end{bmatrix}
\rightarrow
\begin{bmatrix}
1 & 2 & 3 & 4\\
2 & 1 & 4 & 3\\
3 & 4 & 1 & 2\\
4 & 3 & 2 & 1\\
\end{bmatrix}
\rightarrow
\begin{bmatrix}
1 & 2 & 3 & 4 & 5 & 6 & 7 & 8\\
2 & 1 & 4 & 3 & 6 & 5 & 8 & 7\\
3 & 4 & 1 & 2 & 7 & 8 & 5 & 6\\
4 & 3 & 2 & 1 & 8 & 7 & 6 & 5\\
5 & 6 & 7 & 8 & 1 & 2 & 3 & 4\\
6 & 5 & 8 & 7 & 2 & 1 & 4 & 3\\
7 & 8 & 5 & 6 & 3 & 4 & 1 & 2\\
8 & 7 & 6 & 5 & 4 & 3 & 2 & 1\\
\end{bmatrix}
\rightarrow
\dots
$$
Some properties:

* All matrices are symmetric.

* The recurrence is 
  $$
  A'_{2n\times 2n} = \left[
  \begin{array}{c|c}
  A & A + n\\
  \hline
  A + n & A\\
  \end{array}
  \right],
  \text{if $A$ is a $n \times n$ matrix, where $n$ is a power of 2.}
  $$



Assume we have an infinitely large board $A$ generated by the rule above. A query receives five integers $x_1, x_2, y_1, y_2, \delta$ such that $0 \le x_1 \le x_2 \le 10^9$, $0 \le y_1 \le y_2 \le 10^9$ and outputs the sum of those numbers in $A[x_1:x_2, y_1:y_2]$ that are no greater than $\delta$.



**Solution:**





The interesting part is the time complexity of $F$.



**Definition:**
We say $f(i, j, k)$ is a **full** **query** if $i = j$.

**Lemma 1:**

Assume that the initial call to $f$ is $f(I, J, K)$ and let $f(i, j, k)$ be some middle state produced by our algorithm. Then,

1. $j$ must be a suffix (in base-2) of $J$;

* $k$ must be a suffix (in base-2) of $K$;
* $(i-1) \& J = j$







Java solution can be found at [here](https://github.com/lydxlx1/icpc/blob/master/src/com/codeforces/_809C.java).